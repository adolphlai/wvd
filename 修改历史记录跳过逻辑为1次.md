# 修改历史记录跳过逻辑：从3次改为1次

## 🤔 为什么设计成3次？

可能的设计原因（推测）：
1. **容错性**：防止误判（网络延迟、识别错误等）
2. **宝箱随机刷新**：某些地城的宝箱可能随机出现
3. **地图变化**：不同轮次可能有细微差异

## ❌ 但您说得对！

对于**固定地图结构**（如水路一号街）：
- 如果第一次搜索"左上"没找到，**说明那个方向确实没有宝箱**
- **不需要等3次，浪费时间和效率**
- 应该**立即跳过**

## ✅ 修改方案

### 方案1：改为1次就跳过（推荐）

修改 `src/chest_direction_history.py`：

**第53行：**
```python
# 修改前
def should_search_direction(self, dungeon_name, direction, target='chest', min_attempts=3):

# 修改后
def should_search_direction(self, dungeon_name, direction, target='chest', min_attempts=1):
```

**效果：**
- 第一次没找到 → 第二次就跳过
- 大幅提升效率
- 适合固定地图结构

### 方案2：完全禁用优化

修改 `src/script.py` 第1389-1395行：

**注释掉历史记录检查：**
```python
# 優化：檢查是否應該搜尋此方向
# - chest: 跳過多次確認沒有寶箱的方向
# - harken: 如果已知位置，只搜尋該方向
# if direction_history is not None:
#     dungeon_name = setting._FARMTARGET
#     should_search = direction_history.should_search_direction(dungeon_name, swipeDir, target=target)
#     if not should_search:
#         direction_name = direction_history._normalize_direction(swipeDir)
#         logger.info(f"{target}優化: 方向 [{direction_name}] 已確認無目標，跳過")
#         continue
```

**效果：**
- 每次都搜索所有方向
- 完全忽略历史记录
- 适合宝箱位置完全随机的场景

### 方案3：改为可配置参数（最佳）

如果您想让用户可以配置，可以：

1. 在配置文件中添加参数
2. 或者通过环境变量控制

但目前代码没有这个功能，需要自行添加。

## 🎯 推荐修改

直接修改为 `min_attempts=1`：

```python
# src/chest_direction_history.py 第53行
def should_search_direction(self, dungeon_name, direction, target='chest', min_attempts=1):
```

**逻辑变化：**

**修改前（min_attempts=3）：**
```
第1次：搜索左上 → 没找到 → 记录 attempts=1 → 继续
第2次：搜索左上 → 没找到 → 记录 attempts=2 → 继续
第3次：搜索左上 → 没找到 → 记录 attempts=3 → 继续
第4次：搜索左上 → 检查历史 → attempts=3 → 跳过！
```

**修改后（min_attempts=1）：**
```
第1次：搜索左上 → 没找到 → 记录 attempts=1 → 继续
第2次：搜索左上 → 检查历史 → attempts=1 → 跳过！✅
```

**效率提升：**
- 节省 2/3 的搜索时间
- 立即跳过确定没有宝箱的方向


---
description: TARGETINFOLIST 歷史記錄機制與方向優化
---

# TARGETINFOLIST 歷史記錄機制

## 核心結論

歷史記錄是基於 **「地城名稱 + 方向」**，不是基於單個目標項。

- 多個目標項共享同一個歷史記錄（如果地城和方向相同）
- 每次搜索都會更新歷史記錄
- 下次遇到相同方向時，會檢查歷史記錄決定是否跳過

## 存儲結構

```json
{
  "Dist": {
    "chest": {
      "左上": {"attempts": 5, "found": 2},
      "右上": {"attempts": 3, "found": 3}
    }
  }
}
```

Key 是地城名稱（`setting._FARMTARGET`），方向是標準化的。

## 配置A vs 配置B

### 配置A：單一目標（默認5方向）
```json
["chest"]  // swipeDir=None → 轉換為5個方向
```
- 遍歷 5 個方向
- 找到第一個就停止

### 配置B：多個目標（每個方向一個）
```json
["chest", "左上", null],
["chest", "右上", null],
["chest", "左下", null]
```
- 每個目標項獨立處理
- 找到後不會移除目標

## 跳過邏輯

```python
if attempts >= 3 and found == 0:
    return False  # 跳過
```

## 重要區別

| 特性 | 配置A | 配置B |
|------|-------|-------|
| 目標項數量 | 1個 | 4個 |
| 每個目標方向數 | 5個 | 1個 |
| 找到就停止 | ✅ | ❌ |
| 跳過影響 | 整個目標項 | 只影響該方向 |

---
name: 城鎮傳送系統
description: 說明從旅店傳送到世界地圖再到地下城的邏輯，包含 StateEoT、TeleportFromCityToWorldLocation。當使用者詢問傳送、世界地圖、或 EoT 相關問題時，應啟用此技能。
---

# 城鎮傳送系統 (Town Teleport System)

## 檔案位置
`src/script.py`

## 核心函數

### StateEoT() - 邊緣之城狀態處理
- **位置**: line 1826
- **功能**: 處理從旅店到地下城的傳送流程

### TeleportFromCityToWorldLocation() - 城市到世界地點傳送
- **位置**: line 1346
- **功能**: 執行具體的傳送操作

## 傳送流程

```
旅店 (Inn)
    │
    ▼
┌─────────────────┐
│ 前往邊緣之城    │
│ (EoT)           │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 選擇傳送目的地  │
└────────┬────────┘
         │
    ┌────┴────────────┐
    │                 │
    ▼                 ▼
 王城盧克納利亞    要塞
    │                 │
    └────────┬────────┘
             │
             ▼
┌─────────────────┐
│ 世界地圖導航    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 進入地下城      │
└─────────────────┘
```

## 傳送目的地

| 目的地 | 說明 |
|--------|------|
| 王城盧克納利亞 | 主城傳送點 |
| 要塞 | 邊境傳送點 |
| 世界地圖各地點 | 根據任務配置 |

## 世界地圖導航

1. 打開世界地圖
2. 縮放調整視野
3. 滑動到目標區域
4. 點擊目標地點
5. 確認進入

## 配置項

| 設定 | 說明 |
|------|------|
| `setting._FARMTARGET` | 農場目標地點 |
| `setting._TELEPORTDEST` | 傳送目的地 |
| `setting._WORLDMAPZOOM` | 世界地圖縮放等級 |

## 狀態轉換

```
State.Inn ──休息完成──▶ State.EoT ──傳送完成──▶ State.Dungeon
```

## 相關圖片資源

- `eotFlag.png` - 邊緣之城標識
- `teleportButton.png` - 傳送按鈕
- `worldmapFlag.png` - 世界地圖標識
- `dungeonEntrance.png` - 地下城入口

## 異常處理

- 傳送失敗：重試傳送操作
- 世界地圖縮放異常：調整縮放後重試
- 找不到目標：執行 gohome 返回旅店

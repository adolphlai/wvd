---
name: 旅店恢復系統
description: 說明旅店邏輯，包含住宿、自動補給、背包整理、房間選擇。當使用者詢問旅店、休息、補給相關問題時，應啟用此技能。
---

# 旅店恢復系統 (Inn & Recovery System)

## 檔案位置
`src/script.py`

## 核心函數

### StateInn() - 旅店狀態處理
- **位置**: line 1804
- **功能**: 處理旅店內的所有操作

## 旅店流程

```
進入旅店
    │
    ▼
┌─────────────────┐
│ 檢測旅店狀態    │
└────────┬────────┘
         │
    ┌────┴────────────┐
    │                 │
    ▼                 ▼
 需要整理背包？    直接休息
    │                 │
    ▼                 ▼
 StateOrganizeBackpack   選擇房間
    │                 │
    └────────┬────────┘
             │
             ▼
        住宿恢復
             │
             ▼
        前往 EoT
```

## 房間選擇

| 房間類型 | 說明 |
|----------|------|
| 王套房 | 完全恢復，價格高 |
| 經濟房 | 部分恢復，價格低 |

配置項：`setting._USEEXPENSIVEROOM`

## 自動補給

旅店中可執行：
- 購買藥水
- 整理背包
- 存放物品

## 相關狀態轉換

```
Inn ──休息完成──▶ EoT ──傳送──▶ Dungeon
 ▲                              │
 └──────────gohome──────────────┘
```

## RuntimeContext 相關變數

| 變數 | 說明 |
|------|------|
| `_FIRST_COMBAT_AFTER_INN` | 返回旅店後戰鬥計數器 |
| `_ORGANIZE_PENDING` | 待整理背包標誌 |

## 相關圖片資源

- `innFlag.png` - 旅店標識
- `restButton.png` - 休息按鈕
- `expensiveRoom.png` - 王套房選項

# 功能說明：美麗礦石的真相跳躍與蠍女任務優化

本文件統整了針對「美麗礦石的真相」跳躍節點新增，以及「蠍女」任務流程優化的相關改動與實作細節。

## 一、 改動目標
1. **新增跳躍節點**：在「因果之輪」中新增對「美麗礦石的真相」 (`trueofthebeautifulore`) 的支持。
2. **優化導航邏輯**：解決跳躍過程中的頁面識別問題，提升自動化穩定性。
3. **優化任務流程**：針對「蠍女」任務，在特定跳躍條件下跳過冗餘導航步驟，縮短每輪耗時。
4. **GUI 整合**：提供開關供使用者根據需求選擇是否啟用此功能。

---

## 二、 實作細節

### 1. 配置清單更新 (`script.py`)
在 `CONFIG_VAR_LIST` 中新增了配置項，確保設定可持久化儲存於 `config.json`：
- `_ACTIVE_ORE_JUMP` (bool): 控制是否開啟跳躍到「美麗礦石的真相」。

### 2. 時間跳躍邏輯分流 (`script.py`)
修改了 `CursedWheelTimeLeap` 函數，實作了搜尋邏輯的條件分支：
- **開啟「美麗礦石」時**：
    - 跳躍目標 (`target`) 設為 `trueofthebeautifulore`。
    - 搜尋清單擴展為 `[target, 'deepsnowhinterlands', 'GhostsOfYore']`。
    - **原理**：只要畫面出現目標節點、深雪邊境標籤或昔日之影標籤，即停止切換頁面。這解決了腳本因找不到「要塞」關鍵字而跳過正確頁面的問題。
- **未開啟時 (預設)**：
    - 維持原有的單一目標搜尋 `cursedwheel_impregnableFortress`，確保對其他現有任務的影響最小化。

### 3. 蠍女任務優化 (`script.py`)
在 `QuestFarm` 的 `Scorpionesses` 案例中新增判斷：
- **條件**：若 `_ACTIVE_ORE_JUMP` 為開啟。
- **動作**：執行完時間跳躍後，自動跳過「返回要塞」與「前往王城」的步驟。
- **效益**：由於「美麗礦石的真相」節點直接位於王城內部，跳過這些步驟可節省約 10-15 秒的導航時間。

### 4. GUI 界面 (`gui.py`)
- 在「進階設定 -> 其他」區塊新增了核取方塊。
- 文字：`跳躍到"美麗礦石的真相"`
- 綁定變數：`active_ore_jump_var`

---

## 三、 蠍女任務流程解析與對照

### 1. 原始任務流程 (無優化)
在一般的「蠍女」案例中，腳本會執行一連串固定的導航步驟：
1. **因果跳躍**：執行標準 `CursedWheelTimeLeap()`，回到預設節點重置世界。
2. **返回要塞**：從遺跡或當前位置回到旅店/要塞 (`Inn`)。
3. **前往王城**：傳送至 `RoyalCityLuknalia` 標誌物。
4. **懸賞揭榜**：進入公會，橫向滑動至懸賞分頁並領取。
5. **狩獵導航**：
    - 路徑：王城 -> 奈落入口 -> 寺院 B2F。
    - 地城移動：前往寫死的座標 `[505, 760]` 與 `[506, 821]` 進行擊殺。
6. **提交懸賞**：回城前往公會回報任務。
7. **休息檢查**：根據刷地城次數決定是否回旅店。

### 2. 優化後的完整流程 (開啟"美麗礦石"時)
開啟此選項後，流程將變得更精簡且穩定：
1. **標定跳躍**：執行 `CursedWheelTimeLeap` 並針對性跳轉至 `trueofthebeautifulore` 節點。
2. **[跳過] 返回要塞**：因為節點已位於市中心，省去此步驟。
3. **[跳過] 前往王城**：同上，原地即是王城範圍。
4. **懸賞揭榜**：直接在公會領取。
5. **狩獵導航**：執行原有的導航與座標擊殺邏輯。
6. **提交懸賞**：回報任務。
7. **休息檢查**：執行設定的休息邏輯。

### 3. GUI 選項與流程分支對照
腳本會根據 GUI 中的核取方塊狀態自動切換執行的代碼路徑：

| GUI 選項：跳躍到"美麗礦石的真相" | 使用流程 | 時間跳躍導航策略 | 蠍女任務步驟 |
| :--- | :--- | :--- | :--- |
| **未勾選 (預設)** | **原始流程** | 僅檢查「要塞奪還」標籤，未見則持續切換頁面。 | 完整 7 個步驟 (包含返回要塞與前往王城)。 |
| **已勾選** | **優化流程** | **廣泛搜尋模式**：同時檢查目標節點、深雪邊境及昔日之影。 | 精簡流程：自動跳過第 2 與第 3 步驟。 |

---

---

## 四、 使用說明
1. 前往 **[進階設定]** 分頁。
2. 在下方 **[其他]** 區塊中勾選 **「跳躍到"美麗礦石的真相"」**。
3. 切換至蠍女任務預設或手動啟動蠍女任務。
4. 腳本將自動執行優化後的跳躍與導航流程。

> [!NOTE]
> 建議在修改設定後重新啟動應用程式，以確保配置完全套用。

---

## 四、 驗證紀錄
- **跳躍目標驗證**：日誌確認目標已改為 `trueofthebeautifulore`。
- **步驟跳過驗證**：日誌確認顯示 `跳過第二步與第三步 (已在王城)...`。
- **異常處理**：分支搜尋邏輯已解決因頁面識別失敗導致的導航卡死問題。

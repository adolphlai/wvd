# 功能計劃：技能施放設定改為按角色配置（修正版）

## 目標
將技能施放設定從「按順序（1~6）」改為「按角色名稱」配置

---

## GUI 結構（6 組角色配置）

```
┌─ 角色技能設定 ─────────────────────────────────────────────────┐
│ 觸發間隔: [0]  ※ 0=每場觸發                                    │
│ ※ 未識別角色時使用普攻                                         │
│                                                                │
│         角色      類別      技能            等級                │
│ 首戰    [公主▼]   [單體▼]   [skill▼]       [LV5▼]              │
│ 二戰後            [全體▼]   [skill▼]       [關閉▼]             │
│                                                                │
│ 首戰    [狐狸▼]   [單體▼]   [skill▼]       [LV3▼]              │
│ 二戰後            [全體▼]   [skill▼]       [關閉▼]             │
│                                                                │
│ 首戰    [獅櫻▼]   [單體▼]   [skill▼]       [LV5▼]              │
│ 二戰後            [全體▼]   [skill▼]       [關閉▼]             │
│                                                                │
│ 首戰    [    ▼]   [    ▼]   [     ▼]       [關閉▼]             │
│ 二戰後            [    ▼]   [     ▼]       [關閉▼]             │
│                                                                │
│ 首戰    [    ▼]   [    ▼]   [     ▼]       [關閉▼]             │
│ 二戰後            [    ▼]   [     ▼]       [關閉▼]             │
│                                                                │
│ 首戰    [    ▼]   [    ▼]   [     ▼]       [關閉▼]             │
│ 二戰後            [    ▼]   [     ▼]       [關閉▼]             │
└────────────────────────────────────────────────────────────────┘
```

**重點：**
- 共 6 組角色配置（12 行）
- 每組有 2 行：首戰行（含角色下拉）、二戰後行（共用同一角色）
- 角色下拉選單只在「首戰」行顯示，二戰後共用該角色
- 第 1-2 行共用角色 A、第 3-4 行共用角色 B、...、第 11-12 行共用角色 F

---

## 配置結構

```python
_CHARACTER_SKILL_CONFIG = [
    {
        "character": "公主",
        "skill_first": "unendingdeaths", "level_first": "LV5",
        "skill_after": "LAERLIK", "level_after": "關閉"
    },
    {
        "character": "狐狸",
        "skill_first": "xxx", "level_first": "LV3",
        "skill_after": "yyy", "level_after": "關閉"
    },
    # ... 共 6 項
]
```

---

## 戰鬥邏輯

1. 偵測當前行動角色（DetectCharacter）
2. 遍歷列表查找匹配的角色配置
3. 根據 battle_num 施放首戰或二戰後技能
4. 未找到匹配角色時使用普攻

---

## 需要保留的功能

| 功能 | 配置/變數 | 說明 |
|------|-----------|------|
| 自動戰鬥模式 | `_AUTO_COMBAT_MODE` | 完全自動/1場後自動/2場後自動/3場後自動/完全手動 |
| 觸發間隔 | `_AE_CASTER_INTERVAL` | 控制每隔多少次地城觸發技能施放 |
| 首戰/二戰後區分 | `battle_num` | 第1戰用首戰技能，第2戰後用二戰後技能 |
| 黑屏檢測 | - | N戰後自動時，前N戰需要打斷自動戰鬥 |

---

## 修改清單

### gui.py - _create_skills_tab
- 迴圈建立 6 組角色配置 UI
- 每組：
  - 首戰行：角色下拉、類別、技能、等級
  - 二戰後行：類別、技能、等級（共用角色）

### script.py - get_skill_for_character
- 遍歷列表查找匹配角色
- 返回對應的 skill_first/after 和 level

### script.py - has_skill_config / 黑屏偵測
- 檢查列表中是否有任何角色配置了技能

### utils.py - migrate_skill_config
- 處理列表格式的遷移

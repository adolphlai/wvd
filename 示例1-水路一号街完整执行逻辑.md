# ç¤ºä¾‹1ï¼šæ°´è·¯ä¸€å·è¡—ï¼ˆDistï¼‰å®Œæ•´æ‰§è¡Œé€»è¾‘

## ğŸ“‹ é…ç½®

```json
"Dist": {
    "_TYPE": "dungeon",
    "questName": "[å®ç®±]æ°´è·¯ä¸€å·è¡—",
    "_TARGETINFOLIST": [
        ["chest"],
        ["harken"]
    ],
    "_EOT": [
        ["press", "TradeWaterway", ["EdgeOfTown", [1,1]], 1],
        ["press", "Dist", "input swipe 650 250 650 900", 1]
    ]
}
```

---

## ğŸ”„ å®Œæ•´æ‰§è¡Œæµç¨‹

### é˜¶æ®µ1ï¼šåˆå§‹åŒ–ï¼ˆState.EoTï¼‰

**ç›®æ ‡ï¼š** ä»åŸé•‡è¿›å…¥"æ°´è·¯ä¸€å·è¡—"åœ°ä¸‹åŸ

```python
def StateEoT():
    # æ­¥éª¤1: ä»åŸé•‡ â†’ è´¸æ˜“æ°´è·¯
    pos = FindCoordsOrElseExecuteFallbackAndWait(
        "TradeWaterway",        # ç›®æ ‡å›¾åƒæ ‡è¯†
        ["EdgeOfTown", [1,1]],  # å¤‡ç”¨ï¼šå¦‚æœæ‰¾ä¸åˆ°ï¼Œç‚¹å‡»å·¦ä¸Šè§’
        1                        # è¶…æ—¶1ç§’
    )
    Press(pos)  # ç‚¹å‡»è´¸æ˜“æ°´è·¯å…¥å£
    
    # æ­¥éª¤2: åœ¨ä¸–ç•Œåœ°å›¾ä¸Šæ»‘åŠ¨ï¼Œæ‰¾åˆ°"Dist"åŒºåŸŸ
    pos = FindCoordsOrElseExecuteFallbackAndWait(
        "Dist",                    # ç›®æ ‡å›¾åƒæ ‡è¯†
        "input swipe 650 250 650 900",  # å¤‡ç”¨ï¼šå‘ä¸‹æ»‘åŠ¨åœ°å›¾
        1
    )
    Press(pos)  # ç‚¹å‡»DiståŒºåŸŸ
    
    # æ­¥éª¤3: ç­‰å¾…å¹¶ç‚¹å‡»"è¿›å…¥åœ°ä¸‹åŸ"æŒ‰é’®
    Sleep(1)
    Press(CheckIf(ScreenShot(), 'GotoDung'))
```

**æ‰§è¡ŒåçŠ¶æ€ï¼š** è¿›å…¥åœ°ä¸‹åŸï¼Œåœ°å›¾å…³é—­ï¼Œè§’è‰²åœ¨èµ·ç‚¹ä½ç½®

---

### é˜¶æ®µ2ï¼šæ‰“å¼€åœ°å›¾ï¼ˆState.Dungeon â†’ State.Mapï¼‰

**åœ¨ `StateDungeon()` ä¸­ï¼š**

```python
case DungeonState.Dungeon:
    # æ‰“å¼€åœ°å›¾
    Press([777,150])  # ç‚¹å‡»åœ°å›¾æŒ‰é’®
    Sleep(1)
    dungState = DungeonState.Map
```

**æ‰§è¡ŒåçŠ¶æ€ï¼š** å¤§åœ°å›¾å·²æ‰“å¼€

---

### é˜¶æ®µ3ï¼šæœç´¢å®ç®±ï¼ˆStateSearch â†’ StateMap_FindSwipeClickï¼‰

**3.1 è°ƒç”¨ StateSearch()**

```python
def StateSearch(waitTimer, targetInfoList):
    targetInfo = targetInfoList[0]  # ç¬¬ä¸€ä¸ªç›®æ ‡ï¼š["chest"]
    target = "chest"
    
    # åœ°å›¾å·²ç»æ‰“å¼€ï¼Œæ£€æŸ¥åœ°å›¾æ ‡å¿—
    map = ScreenShot()
    if not CheckIf(map, 'mapFlag'):
        return None, targetInfoList, False
    
    # æœç´¢å®ç®±
    searchResult = StateMap_FindSwipeClick(targetInfo)
```

**3.2 TargetInfo å¯¹è±¡è§£æ**

ä» `["chest"]` æ„å»º `TargetInfo` å¯¹è±¡ï¼š

```python
targetInfo = TargetInfo(
    target="chest",
    swipeDir=None,  # ä¼šè½¬æ¢ä¸ºé»˜è®¤å€¼
    roi=None        # ä¼šè½¬æ¢ä¸ºé»˜è®¤å€¼
)
```

**swipeDir è½¬æ¢ï¼ˆå› ä¸ºä¼ å…¥çš„æ˜¯ Noneï¼‰ï¼š**
```python
swipeDir = [None,                    # ä¸­å¤®ï¼ˆä¸æ»‘åŠ¨ï¼‰
            [100,250,700,1200],      # å·¦ä¸Š
            [700,250,100,1200],      # å³ä¸Š
            [700,1200,100,250],      # å³ä¸‹
            [100,1200,700,250]]      # å·¦ä¸‹
```

**roi è½¬æ¢ï¼ˆå› ä¸º target="chest" ä¸” roi=Noneï¼‰ï¼š**
```python
roi = [[0,0,900,1600]] + [          # æœç´¢åŒºåŸŸï¼šå…¨å±
    [0,0,900,208],      # æ’é™¤ï¼šé¡¶éƒ¨UI
    [0,1265,900,335],   # æ’é™¤ï¼šåº•éƒ¨UI
    [0,636,137,222],    # æ’é™¤ï¼šå·¦ä¾§UI
    [763,636,137,222],  # æ’é™¤ï¼šå³ä¾§UI
    [336,208,228,77],   # æ’é™¤ï¼šé¡¶éƒ¨ä¸­é—´UI
    [336,1168,228,97]   # æ’é™¤ï¼šåº•éƒ¨ä¸­é—´UI
]
```

**3.3 æ‰§è¡Œ StateMap_FindSwipeClick()**

```python
def StateMap_FindSwipeClick(targetInfo):
    target = "chest"
    roi = [[0,0,900,1600], [0,0,900,208], ...]  # ä¸Šé¢è½¬æ¢çš„ç»“æœ
    
    # åˆå§‹åŒ–å†å²è®°å½•
    direction_history = ChestDirectionHistory()
    targetPos = None
    
    # å¾ªç¯éå†5ä¸ªæ–¹å‘
    for i in range(5):  # len(swipeDir) = 5
        # ============================================
        # æ–¹å‘ 0: ä¸­å¤®ï¼ˆswipeDir = Noneï¼‰
        # ============================================
        if i == 0:
            swipeDir = None
            
            # æ£€æŸ¥æ˜¯å¦åº”è¯¥æœç´¢ï¼ˆå†å²è®°å½•ä¼˜åŒ–ï¼‰
            should_search = direction_history.should_search_direction(
                "Dist", None, target="chest"
            )
            # å‡è®¾ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œæ²¡æœ‰å†å²è®°å½•ï¼Œè¿”å› True
            
            # ä¸æ»‘åŠ¨ï¼ˆswipeDir is Noneï¼‰
            logger.info("> æœç´¢æ–¹å‘: [ä¸­å¤®]")
            scn = ScreenShot()
            
            # åº”ç”¨ROIå¤„ç†
            search_area = CutRoI(scn, roi)
            # CutRoIé€»è¾‘ï¼š
            # - ä¿ç•™ç¬¬ä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼š[0,0,900,1600]ï¼ˆå…¨å±ï¼‰
            # - å°†åç»­çŸ©å½¢åŒºåŸŸè®¾ä¸ºé»‘è‰²ï¼ˆæ’é™¤UIå…ƒç´ ï¼‰
            
            # å›¾åƒåŒ¹é…æœç´¢
            targetPos = CheckIf(search_area, "chest", roi)
            # CheckIfé€»è¾‘ï¼š
            # - åŠ è½½å®ç®±æ¨¡æ¿å›¾åƒ
            # - åœ¨search_areaä¸­åŒ¹é…ï¼ˆé˜ˆå€¼80%ï¼‰
            # - è¿”å›åŒ¹é…ä½ç½®åæ ‡æˆ–None
            
            if targetPos:
                logger.info('[ä¸­å¤®] æ‰¾åˆ° chest!')
                # è®°å½•æ‰¾åˆ°
                direction_history.record_search_result("Dist", None, True, "chest")
                break  # æ‰¾åˆ°å®ç®±ï¼Œé€€å‡ºå¾ªç¯
            else:
                logger.info('[ä¸­å¤®] æ²¡æ‰¾åˆ° chest')
                # è®°å½•æœªæ‰¾åˆ°
                direction_history.record_search_result("Dist", None, False, "chest")
                # ç»§ç»­ä¸‹ä¸€ä¸ªæ–¹å‘
        
        # ============================================
        # æ–¹å‘ 1: å·¦ä¸Šï¼ˆswipeDir = [100,250,700,1200]ï¼‰
        # ============================================
        elif i == 1:
            swipeDir = [100,250,700,1200]
            
            # æ£€æŸ¥å†å²è®°å½•
            should_search = direction_history.should_search_direction(
                "Dist", swipeDir, target="chest"
            )
            # ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œè¿”å› True
            
            # æ‰§è¡Œæ»‘åŠ¨
            logger.info("> æ»‘åŠ¨åœ°å›¾: [å·¦ä¸Š]")
            DeviceShell("input swipe 100 250 700 1200")
            Sleep(2)  # ç­‰å¾…åœ°å›¾ç¨³å®š
            scn = ScreenShot()
            
            # åº”ç”¨ROIå¤„ç†
            search_area = CutRoI(scn, roi)
            
            # å›¾åƒåŒ¹é…
            targetPos = CheckIf(search_area, "chest", roi)
            
            if targetPos:
                logger.info('[å·¦ä¸Š] æ‰¾åˆ° chest!')
                direction_history.record_search_result("Dist", swipeDir, True, "chest")
                break
            else:
                logger.info('[å·¦ä¸Š] æ²¡æ‰¾åˆ° chest')
                direction_history.record_search_result("Dist", swipeDir, False, "chest")
        
        # ============================================
        # æ–¹å‘ 2-4: å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹
        # ============================================
        # ï¼ˆæ‰§è¡Œé€»è¾‘åŒä¸Šï¼Œä¾æ¬¡æœç´¢æ¯ä¸ªæ–¹å‘ï¼‰
        # ...
    
    return targetPos  # è¿”å›æ‰¾åˆ°çš„åæ ‡æˆ– None
```

**å…³é”®ç‚¹ï¼š**
- **åªè¦æ‰¾åˆ°ä¸€ä¸ªæ–¹å‘çš„å®ç®±ï¼Œç«‹å³ `break`ï¼Œä¸ä¼šç»§ç»­æœç´¢å…¶ä»–æ–¹å‘**
- **æ¯ä¸ªæ–¹å‘æœç´¢åä¼šè®°å½•åˆ°å†å²è®°å½•ä¸­**
- **ROIå¤„ç†ï¼šç¬¬ä¸€ä¸ªçŸ©å½¢æ˜¯æœç´¢åŒºåŸŸï¼Œåç»­æ˜¯æ’é™¤åŒºåŸŸ**

---

### é˜¶æ®µ4ï¼šå¤„ç†æœç´¢ç»“æœ

**4.1 å¦‚æœæ‰¾åˆ°å®ç®±ï¼ˆsearchResult != Noneï¼‰**

```python
if searchResult != None:  # å‡è®¾åœ¨"å³ä¸Š"æ–¹å‘æ‰¾åˆ°äº†å®ç®±
    if target == 'chest':  # True
        # ç‚¹å‡»å®ç®±ä½ç½®
        Press(searchResult)  # ä¾‹å¦‚ï¼š[450, 600]
        
        # ç‚¹å‡»AutoMoveæŒ‰é’®ï¼Œå¼€å§‹è‡ªåŠ¨ç§»åŠ¨
        Press([280, 1433])   # AutoMoveæŒ‰é’®ä½ç½®
        
        # è¿›å…¥ç§»åŠ¨çŠ¶æ€
        return StateMoving_CheckFrozen(), targetInfoList, True
```

**4.2 å¦‚æœæ²¡æ‰¾åˆ°å®ç®±ï¼ˆsearchResult == Noneï¼‰**

```python
if searchResult == None:
    if target == 'chest':  # True
        # ä»ç›®æ ‡åˆ—è¡¨ç§»é™¤å½“å‰ç›®æ ‡
        targetInfoList.pop(0)  # ç§»é™¤ ["chest"]
        logger.info("æ²¡æœ‰æ‰¾åˆ°å®ç®±.\nåœæ­¢æ£€ç´¢å®ç®±.")
        
        # è¿”å›åœ°å›¾çŠ¶æ€ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªç›®æ ‡ï¼ˆharkenï¼‰
        return DungeonState.Map, targetInfoList, False
        # ç°åœ¨ targetInfoList = [["harken"]]
```

---

### é˜¶æ®µ5ï¼šç§»åŠ¨åˆ°å®ç®±ï¼ˆStateMoving_CheckFrozenï¼‰

**å¦‚æœæ‰¾åˆ°äº†å®ç®±ï¼Œæ‰§è¡Œç§»åŠ¨ï¼š**

```python
def StateMoving_CheckFrozen():
    lastscreen = None
    logger.info("[ç§»å‹•æª¢æ¸¬] ç§»åŠ¨.")
    
    while 1:
        Sleep(0.5)  # æ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡
        
        # è¯†åˆ«å½“å‰çŠ¶æ€
        _, dungState, screen = IdentifyState()
        
        # å¦‚æœçŠ¶æ€æ”¹å˜ï¼ˆåˆ°è¾¾ç›®æ ‡ã€è¿›å…¥æˆ˜æ–—ã€é‡åˆ°å®ç®±ç­‰ï¼‰
        if dungState != DungeonState.Dungeon:
            # å¯èƒ½çš„çŠ¶æ€ï¼š
            # - DungeonState.Chestï¼ˆåˆ°è¾¾å®ç®±ï¼‰
            # - DungeonState.Combatï¼ˆé‡åˆ°æˆ˜æ–—ï¼‰
            break
        
        # æ£€æŸ¥ç”»é¢æ˜¯å¦åœæ­¢ç§»åŠ¨ï¼ˆå¡ä½æ£€æµ‹ï¼‰
        if lastscreen is not None:
            gray1 = cv2.cvtColor(screen, cv2.COLOR_BGR2GRAY)
            gray2 = cv2.cvtColor(lastscreen, cv2.COLOR_BGR2GRAY)
            mean_diff = cv2.absdiff(gray1, gray2).mean()/255
            
            if mean_diff < 0.1:  # ç”»é¢å‡ ä¹æ²¡å˜åŒ–
                dungState = None  # åœæ­¢ç§»åŠ¨
                break
        
        lastscreen = screen
    
    return dungState  # è¿”å›æ–°çŠ¶æ€
```

**æ‰§è¡ŒåçŠ¶æ€ï¼š**
- åˆ°è¾¾å®ç®± â†’ `DungeonState.Chest`
- é‡åˆ°æˆ˜æ–— â†’ `DungeonState.Combat`
- ç”»é¢åœæ­¢ â†’ `None`ï¼ˆå¯èƒ½å¡ä½ï¼‰

---

### é˜¶æ®µ6ï¼šå¼€ç®±ï¼ˆStateChestï¼‰

**å¦‚æœåˆ°è¾¾å®ç®±ï¼Œæ‰§è¡Œå¼€ç®±æµç¨‹ï¼š**

```python
def StateChest():
    # 6.1 ç­‰å¾…å¼€ç®±ç•Œé¢å‡ºç°
    FindCoordsWithLogging(
        ['dungFlag', 'combatActive', 'chestOpening', 'whowillopenit'],
        [[1,1], [1,1], 'chestFlag'],
        0.5
    )
    
    scn = ScreenShot()
    
    # 6.2 å¦‚æœå‡ºç°é€‰äººç•Œé¢
    if CheckIf(scn, 'whowillopenit'):
        # é€‰æ‹©è§’è‰²
        if setting._WHOWILLOPENIT == 0:  # éšæœº
            whowillopenit = random.choice([0,1,2,3,4,5])
        else:
            whowillopenit = setting._WHOWILLOPENIT - 1
        
        pos = [258+(whowillopenit%3)*258, 1161+((whowillopenit)//3)%2*184]
        Press(pos)  # ç‚¹å‡»è§’è‰²
        Sleep(1.5)
        
        # å¦‚æœä¸æ˜¯æ™ºèƒ½å¼€ç®±ï¼Œè¿ç»­ç‚¹å‡»è§£é™¤é™·é˜±
        if not setting._SMARTDISARMCHEST:
            for _ in range(8):
                Press([515,934])  # è§£é™¤é™·é˜±æŒ‰é’®
                Sleep(0.3)
    
    # 6.3 å¦‚æœæ­£åœ¨å¼€ç®±ä¸­
    if CheckIf(scn, 'chestOpening'):
        if setting._SMARTDISARMCHEST:
            ChestOpen()  # æ™ºèƒ½å¼€ç®±ï¼ˆä¸‰è§’æ³¢é¢„æµ‹ï¼‰
        else:
            # ç­‰å¾…å¼€ç®±å®Œæˆ
            FindCoordsWithLogging(
                ['dungFlag', 'combatActive', 'chestFlag'],
                [disarm, disarm, disarm],
                0.5
            )
    
    # 6.4 å¼€ç®±å®Œæˆå
    if CheckIf(scn, 'dungFlag'):
        # è¿”å›åœ°ä¸‹åŸçŠ¶æ€ï¼Œç»§ç»­æœç´¢ä¸‹ä¸€ä¸ªå®ç®±
        return DungeonState.Dungeon
```

**æ‰§è¡ŒåçŠ¶æ€ï¼š** å®ç®±å·²å¼€å¯ï¼Œè¿”å› `DungeonState.Dungeon`

---

### é˜¶æ®µ7ï¼šç»§ç»­æœç´¢ï¼ˆå¾ªç¯å›åˆ°é˜¶æ®µ2ï¼‰

**å¼€ç®±å®Œæˆåï¼Œå›åˆ° StateDungeon()ï¼š**

```python
case DungeonState.Dungeon:
    # å†æ¬¡æ‰“å¼€åœ°å›¾
    Press([777,150])
    Sleep(1)
    dungState = DungeonState.Map
```

**ç„¶åå†æ¬¡æ‰§è¡Œ StateSearch()ï¼š**

```python
# targetInfoList ä»ç„¶æ˜¯ [["chest"], ["harken"]]
# ç¬¬ä¸€ä¸ªç›®æ ‡è¿˜æ˜¯ "chest"ï¼Œä¼šå†æ¬¡æœç´¢æ‰€æœ‰æ–¹å‘
```

**æ³¨æ„ï¼š**
- **"chest" ç›®æ ‡ä¸ä¼šè‡ªåŠ¨ç§»é™¤**
- **æ¯æ¬¡å¾ªç¯éƒ½ä¼šé‡æ–°æœç´¢æ‰€æœ‰æ–¹å‘**
- **è¿™æ„å‘³ç€å¦‚æœå®ç®±ä¼šåˆ·æ–°ï¼Œè„šæœ¬ä¼šæŒç»­æœç´¢å’Œå¼€ç®±**

---

### é˜¶æ®µ8ï¼šæ‰¾ä¸åˆ°å®ç®±åï¼Œæœç´¢ä¼ é€ç‚¹

**å¦‚æœæŸæ¬¡å¾ªç¯ä¸­ï¼Œæ‰€æœ‰æ–¹å‘éƒ½æ²¡æ‰¾åˆ°å®ç®±ï¼š**

```python
# åœ¨ StateSearch() ä¸­
if searchResult == None:
    if target == 'chest':
        targetInfoList.pop(0)  # ç§»é™¤ ["chest"]
        # ç°åœ¨ targetInfoList = [["harken"]]
        return DungeonState.Map, targetInfoList, False
```

**ä¸‹ä¸€æ¬¡ StateSearch() è°ƒç”¨ï¼š**

```python
targetInfo = targetInfoList[0]  # ç°åœ¨æ˜¯ ["harken"]
target = "harken"

# harken çš„ swipeDir å’Œ roi å¤„ç†
swipeDir = [None, [100,250,700,1200], ...]  # é»˜è®¤5ä¸ªæ–¹å‘
# ä½†ä¼šè·³è¿‡ä¸­å¤®ï¼ˆä»£ç ä¸­ç‰¹æ®Šå¤„ç†ï¼‰

# æœç´¢ä¼ é€ç‚¹
searchResult = StateMap_FindSwipeClick(targetInfo)
```

**æ‰¾åˆ°ä¼ é€ç‚¹åï¼š**

```python
if searchResult != None:
    if target == 'harken':  # True
        Press(searchResult)      # ç‚¹å‡»ä¼ é€ç‚¹
        Press([280, 1433])       # ç‚¹å‡»AutoMove
        return StateMoving_CheckFrozen(), targetInfoList, True
```

**åˆ°è¾¾ä¼ é€ç‚¹åï¼Œä½¿ç”¨ä¼ é€ç‚¹é€€å‡ºåœ°ä¸‹åŸ**

---

### é˜¶æ®µ9ï¼šé€€å‡ºåå¾ªç¯ï¼ˆå›åˆ°é˜¶æ®µ1ï¼‰

**é€€å‡ºåœ°ä¸‹åŸåï¼Œå›åˆ° State.EoTï¼š**

```python
# é‡æ–°æ‰§è¡Œè¿›å…¥æµç¨‹
StateEoT()
# â†’ è¿›å…¥è´¸æ˜“æ°´è·¯
# â†’ è¿›å…¥DiståŒºåŸŸ
# â†’ é‡æ–°å¼€å§‹å¾ªç¯
```

---

## ğŸ¯ å…³é”®æ‰§è¡Œç‰¹ç‚¹

### 1. å®ç®±æœç´¢çš„å¾ªç¯è¡Œä¸º

**é‡è¦ï¼š`["chest"]` ç›®æ ‡ä¸ä¼šè‡ªåŠ¨ç§»é™¤ï¼**

```python
# æ¯æ¬¡å¾ªç¯éƒ½ä¼šï¼š
# 1. æ‰“å¼€åœ°å›¾
# 2. æœç´¢æ‰€æœ‰5ä¸ªæ–¹å‘çš„å®ç®±
# 3. æ‰¾åˆ°ç¬¬ä¸€ä¸ªå®ç®± â†’ ç§»åŠ¨ â†’ å¼€ç®±
# 4. å¼€ç®±å®Œæˆå â†’ å›åˆ°æ­¥éª¤1ï¼ˆç»§ç»­æœç´¢ï¼‰

# åªæœ‰æ‰€æœ‰æ–¹å‘éƒ½æ‰¾ä¸åˆ°å®ç®±æ—¶ï¼Œæ‰ä¼šç§»é™¤ ["chest"] ç›®æ ‡
```

**è¿™æ„å‘³ç€ï¼š**
- å¦‚æœåœ°å›¾ä¸Šæœ‰å¤šä¸ªå®ç®±ï¼Œè„šæœ¬ä¼š**åå¤æœç´¢ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å®ç®±**
- å¦‚æœå®ç®±ä½ç½®å›ºå®šï¼ˆåˆ·æ–°ååœ¨åŒä¸€ä½ç½®ï¼‰ï¼Œè„šæœ¬ä¼šæŒç»­å¼€åŒä¸€ä¸ªä½ç½®çš„å®ç®±
- å¦‚æœå®ç®±ä½ç½®éšæœºï¼Œè„šæœ¬å¯èƒ½æ¯æ¬¡æ‰¾åˆ°ä¸åŒçš„å®ç®±

### 2. æ–¹å‘æœç´¢ä¼˜å…ˆçº§

**æœç´¢é¡ºåºï¼š**
1. ä¸­å¤®ï¼ˆä¸æ»‘åŠ¨ï¼‰
2. å·¦ä¸Š
3. å³ä¸Š
4. å³ä¸‹
5. å·¦ä¸‹

**å¦‚æœä¸­å¤®æœ‰å®ç®±ï¼Œå°±ä¸ä¼šæœç´¢å…¶ä»–æ–¹å‘ï¼**

### 3. å†å²è®°å½•ä¼˜åŒ–

**ç¬¬ä¸€æ¬¡è¿è¡Œï¼š**
- æ‰€æœ‰æ–¹å‘éƒ½æœç´¢
- è®°å½•æ¯ä¸ªæ–¹å‘çš„æœç´¢ç»“æœ

**åç»­è¿è¡Œï¼ˆç¬¬4æ¬¡å¼€å§‹ï¼‰ï¼š**
- å¦‚æœæŸä¸ªæ–¹å‘3æ¬¡éƒ½æ²¡æ‰¾åˆ°å®ç®± â†’ **è·³è¿‡è¯¥æ–¹å‘**
- å¦‚æœæŸä¸ªæ–¹å‘æ›¾ç»æ‰¾åˆ°è¿‡ â†’ **ç»§ç»­æœç´¢**

**ç¤ºä¾‹ï¼š**
```
ç¬¬1æ¬¡ï¼šä¸­å¤®âœ—ã€å·¦ä¸Šâœ—ã€å³ä¸Šâœ“ã€å³ä¸‹âœ—ã€å·¦ä¸‹âœ—
ç¬¬2æ¬¡ï¼šä¸­å¤®âœ—ã€å·¦ä¸Šâœ—ã€å³ä¸Šâœ“ã€å³ä¸‹âœ—ã€å·¦ä¸‹âœ—
ç¬¬3æ¬¡ï¼šä¸­å¤®âœ—ã€å·¦ä¸Šâœ—ã€å³ä¸Šâœ“ã€å³ä¸‹âœ—ã€å·¦ä¸‹âœ—

ç¬¬4æ¬¡å¼€å§‹ï¼šåªæœç´¢å³ä¸Šï¼ˆå…¶ä»–æ–¹å‘è¢«è·³è¿‡ï¼‰
```

### 4. æ‰¾ä¸åˆ°å®ç®±çš„å¤„ç†

**å¦‚æœæ‰€æœ‰æ–¹å‘éƒ½æ‰¾ä¸åˆ°å®ç®±ï¼š**
```python
targetInfoList.pop(0)  # ç§»é™¤ ["chest"]
# ç»§ç»­ä¸‹ä¸€ä¸ªç›®æ ‡ï¼š["harken"]
```

**è¿™ä¼šè§¦å‘é€€å‡ºæµç¨‹ï¼š**
- æœç´¢ä¼ é€ç‚¹
- ä½¿ç”¨ä¼ é€ç‚¹é€€å‡º
- é‡æ–°è¿›å…¥åœ°ä¸‹åŸï¼ˆæ–°çš„å¾ªç¯ï¼‰

---

## âš ï¸ å¯èƒ½çš„é—®é¢˜

### é—®é¢˜1ï¼šåªå¼€ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å®ç®±

**åŸå› ï¼š** æ‰¾åˆ°å®ç®±åç«‹å³ `break`ï¼Œä¸æœç´¢å…¶ä»–æ–¹å‘

**è§£å†³æ–¹æ¡ˆï¼š** ä¿®æ”¹é…ç½®ï¼Œä¸ºä¸åŒæ–¹å‘çš„å®ç®±åˆ›å»ºå¤šä¸ªç›®æ ‡ï¼š
```json
"_TARGETINFOLIST": [
    ["chest", "å·¦ä¸Š", null],
    ["chest", "å³ä¸Š", null],
    ["chest", "å·¦ä¸‹", null],
    ["chest", "å³ä¸‹", null],
    ["harken"]
]
```

### é—®é¢˜2ï¼šä¸­å¤®æœ‰å®ç®±æ—¶ï¼Œå…¶ä»–æ–¹å‘è¢«å¿½ç•¥

**åŸå› ï¼š** æœç´¢é¡ºåºä¸­ï¼Œä¸­å¤®æ˜¯ç¬¬ä¸€ä¸ª

**è§£å†³æ–¹æ¡ˆï¼š** é…ç½®ä¸­æŒ‡å®šä¸æœç´¢ä¸­å¤®ï¼š
```json
["chest", "å·¦ä¸Š", null]  # åªæœç´¢å·¦ä¸Šæ–¹å‘
```

### é—®é¢˜3ï¼šå†å²è®°å½•ä¼˜åŒ–å¯¼è‡´æŸäº›æ–¹å‘è¢«æ°¸ä¹…è·³è¿‡

**åŸå› ï¼š** å¦‚æœæŸä¸ªæ–¹å‘å‰3æ¬¡éƒ½æ²¡æ‰¾åˆ°ï¼Œåç»­ä¼šè¢«è·³è¿‡

**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ é™¤ `chest_direction_history.json` é‡ç½®å†å²
- æˆ–è€…ä¿®æ”¹ `min_attempts` å‚æ•°ï¼ˆä»£ç ä¸­æ”¹ä¸ºæ›´å¤§å€¼ï¼‰

### é—®é¢˜4ï¼šå®ç®±ç›®æ ‡ä¸ä¼šè‡ªåŠ¨ç§»é™¤

**åŸå› ï¼š** ä»£ç é€»è¾‘ï¼šåªæœ‰æ‰¾ä¸åˆ°å®ç®±æ—¶æ‰ç§»é™¤

**å½±å“ï¼š** è„šæœ¬ä¼šæŒç»­æœç´¢å®ç®±ï¼Œç›´åˆ°æ‰€æœ‰æ–¹å‘éƒ½æ‰¾ä¸åˆ°

**è¿™æ˜¯è®¾è®¡è¡Œä¸ºï¼š** é€‚åˆåˆ·å®ç®±çš„åœºæ™¯

---

## ğŸ“Š å®Œæ•´æµç¨‹å›¾

```
å¼€å§‹
 â†“
State.EoTï¼ˆè¿›å…¥åœ°ä¸‹åŸï¼‰
 â†“
State.Dungeon â†’ æ‰“å¼€åœ°å›¾ â†’ State.Map
 â†“
StateSearch(["chest"])
 â†“
StateMap_FindSwipeClick()
 â”œâ”€> æ–¹å‘0: ä¸­å¤® â†’ æ‰¾åˆ°ï¼Ÿâ†’ æ˜¯ â†’ break
 â”‚                         â†’ å¦ â†’ ç»§ç»­
 â”œâ”€> æ–¹å‘1: å·¦ä¸Š â†’ æ‰¾åˆ°ï¼Ÿâ†’ æ˜¯ â†’ break
 â”‚                         â†’ å¦ â†’ ç»§ç»­
 â”œâ”€> æ–¹å‘2: å³ä¸Š â†’ æ‰¾åˆ°ï¼Ÿâ†’ æ˜¯ â†’ break â† å‡è®¾è¿™é‡Œæ‰¾åˆ°
 â”‚                         â†’ å¦ â†’ ç»§ç»­
 â”œâ”€> æ–¹å‘3: å³ä¸‹ â†’ æ‰¾åˆ°ï¼Ÿâ†’ æ˜¯ â†’ break
 â”‚                         â†’ å¦ â†’ ç»§ç»­
 â””â”€> æ–¹å‘4: å·¦ä¸‹ â†’ æ‰¾åˆ°ï¼Ÿâ†’ æ˜¯ â†’ break
                         â†’ å¦ â†’ è¿”å›None
 â†“
æ‰¾åˆ°å®ç®±ï¼Ÿ
 â”œâ”€> æ˜¯ â†’ Press(å®ç®±åæ ‡) â†’ Press(AutoMove) â†’ StateMoving_CheckFrozen()
 â”‚                                                      â†“
 â”‚                                           åˆ°è¾¾å®ç®± â†’ StateChest()
 â”‚                                                      â†“
 â”‚                                           å¼€ç®±å®Œæˆ â†’ State.Dungeon
 â”‚                                                      â†“
 â”‚                                           å¾ªç¯å›åˆ°"æ‰“å¼€åœ°å›¾"
 â”‚
 â””â”€> å¦ â†’ targetInfoList.pop(0) â†’ ç§»é™¤["chest"]
                   â†“
          StateSearch(["harken"])
                   â†“
          æ‰¾åˆ°ä¼ é€ç‚¹ â†’ é€€å‡ºåœ°ä¸‹åŸ
                   â†“
          å¾ªç¯å›åˆ°"State.EoT"
```

---

## ğŸ” è°ƒè¯•å»ºè®®

### æŸ¥çœ‹æ—¥å¿—è¾“å‡º

å…³æ³¨è¿™äº›å…³é”®æ—¥å¿—ï¼š
- `"> æœç´¢æ–¹å‘: [ä¸­å¤®]"` - å½“å‰æœç´¢çš„æ–¹å‘
- `"[æ–¹å‘] æ‰¾åˆ° chest!"` - æ‰¾åˆ°å®ç®±çš„æ–¹å‘
- `"æ²¡æœ‰æ‰¾åˆ°å®ç®±.\nåœæ­¢æ£€ç´¢å®ç®±."` - æ‰€æœ‰æ–¹å‘éƒ½æ²¡æ‰¾åˆ°

### æ£€æŸ¥å†å²è®°å½•

æŸ¥çœ‹ `chest_direction_history.json`ï¼š
```json
{
  "Dist": {
    "chest": {
      "ä¸­å¤®": {"attempts": 3, "found": 0},
      "å·¦ä¸Š": {"attempts": 3, "found": 0},
      "å³ä¸Š": {"attempts": 3, "found": 2}
    }
  }
}
```

### æµ‹è¯•ROIæ•ˆæœ

å¦‚æœæ€€ç–‘ROIé…ç½®é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. ä¸´æ—¶ä¿®æ”¹ä»£ç ï¼Œä¿å­˜ROIå¤„ç†åçš„å›¾åƒ
2. æ£€æŸ¥å›¾åƒä¸­å“ªäº›åŒºåŸŸè¢«æ’é™¤äº†
3. ç¡®è®¤å®ç®±æ˜¯å¦åœ¨æœç´¢åŒºåŸŸå†…

